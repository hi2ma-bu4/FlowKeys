var n=class a{root={children:new Map};buffer=[];maxSequenceLength=0;pressedKeys=new Set;aliasMap=new Map;target;keyPushTimeout=30;keyPushTimer=null;static STANDARD_KEY_MAP={Esc:"Escape",Del:"Delete",Return:"Enter",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown"," ":"Space",Ctrl:"Control",Cmd:"Meta",Windows:"Meta"};constructor(e){this.target=e??window,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.target.addEventListener("keydown",this.handleKeyDown,!0),this.target.addEventListener("keyup",this.handleKeyUp,!0)}addAlias(e,i){this.aliasMap.set(e.toLowerCase(),i.map(t=>t.toLowerCase()))}register(e,i){if(!e.length)return;this.maxSequenceLength=Math.max(this.maxSequenceLength,e.length);let t=this.root;for(let r of e){let s=new Set(Array.isArray(r)?r:[r]),o=a.setToKey(this.normalizeCombo(s));t.children.has(o)||t.children.set(o,{children:new Map}),t=t.children.get(o)}t.callback=i}normalizeCombo(e){let i=new Set;for(let t of e){t=(a.STANDARD_KEY_MAP[t]??t).toLowerCase();let r=!1;for(let[s,o]of this.aliasMap)if(o.includes(t)){i.add(s),r=!0;break}r||i.add(t)}return i}static setToKey(e){return Array.from(e).sort().join("+")}handleKeyDown(e){let i=(a.STANDARD_KEY_MAP[e.key]??e.key).toLowerCase(),t=performance.now();this.pressedKeys.add(i),this.keyPushTimer!==null&&clearTimeout(this.keyPushTimer),this.keyPushTimer=window.setTimeout(()=>{this.updateBuffer(),this.keyPushTimer=null},this.keyPushTimeout)}handleKeyUp(e){let i=(a.STANDARD_KEY_MAP[e.key]??e.key).toLowerCase();this.pressedKeys.delete(i)}updateBuffer(){let e=this.normalizeCombo(this.pressedKeys);this.buffer.push(e),this.buffer.length>this.maxSequenceLength&&this.buffer.shift(),this.checkBuffer()}checkBuffer(){if(!this.buffer.length)return;console.log(this.buffer);let e=this.root;for(let i=this.buffer.length-this.maxSequenceLength;i<this.buffer.length;i++){if(i<0)continue;e=this.root;let t=!0;for(let r=i;r<this.buffer.length;r++){let s=a.setToKey(this.buffer[r]);if(!e.children.has(s)){t=!1;break}e=e.children.get(s)}t&&e.callback&&e.callback()}}destroy(){this.target.removeEventListener("keydown",this.handleKeyDown,!0),this.target.removeEventListener("keyup",this.handleKeyUp,!0),this.keyPushTimer!==null&&clearTimeout(this.keyPushTimer),this.buffer=[],this.root={children:new Map},this.pressedKeys.clear(),this.aliasMap.clear(),this.maxSequenceLength=0}};typeof window<"u"&&(window.FlowKeys=n);export{n as FlowKeys};
//# sourceMappingURL=FlowKeys.min.js.map
